name: Build Multiple Dockerfiles

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

env:
  DOCKER_HUB_USERNAME: ${{ secrets.DOCKER_HUB_USERNAME }}
  DOCKER_HUB_PASSWORD: ${{ secrets.DOCKER_HUB_PASSWORD }}

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        service:
          [
            action-reaction-service,
            service-integration-service,
            trigger-service,
            user-management-service,
            workflow-service,
            client
            api-gateway,
          ]
        directory:
          [
            ./services,
            ./services,
            ./services,
            ./services,
            ./services,
            ./,
            ./,
          ]
    steps:
      - name: Checkout code
        uses: actions/checkout@v4.2.2

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3.7.1

      - name: Build Docker image
        run: |
          docker buildx build \
            --file ./${{ matrix.directory }}/${{ matrix.service }}/Dockerfile \
            --tag ${{ matrix.service }}:latest \
            ./${{ matrix.directory }}/${{ matrix.service }}

      - name: Login to Docker Hub
        run: echo "${{ secrets.DOCKER_HUB_PASSWORD }}" | docker login -u ${{ secrets.DOCKER_HUB_USERNAME }} --password-stdin

      - name: Push Docker image
        run: docker push ${{ matrix.service }}:latest
